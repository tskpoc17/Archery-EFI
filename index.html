<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>EFI å°„ç®­é›™è»¸è¨ºæ–·ç³»çµ±</title>
Â  Â  <style>
Â  Â  Â  Â  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f0f2f5; display: flex; justify-content: center; padding: 20px; margin: 0; }
Â  Â  Â  Â  .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 480px; }
Â  Â  Â  Â  h2 { text-align: center; color: #333; margin-top: 0; }
Â  Â  Â  Â  .section-title { background: #e7f3ff; padding: 10px 15px; border-radius: 8px; font-weight: bold; color: #007AFF; margin: 20px 0 10px 0; border-left: 5px solid #007AFF; }
Â  Â  Â  Â  label { font-weight: bold; font-size: 14px; color: #333; display: block; margin-top: 12px; margin-bottom: 5px; }
Â  Â  Â  Â  .row { display: flex; gap: 8px; margin-bottom: 5px; }
Â  Â  Â  Â  .row > div { flex: 1; }
Â  Â  Â  Â  input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 16px; background-color: #fff; }
Â  Â  Â  Â  .note { font-size: 12px; color: #777; background-color: #f8f9fa; padding: 8px; border-radius: 8px; margin-top: 4px; line-height: 1.4; }
Â  Â  Â  Â  button { width: 100%; padding: 16px; background: #007AFF; color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 25px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .res-container { display: none; margin-top: 25px; }
Â  Â  Â  Â  .res-block { padding: 18px; background: #f0f9ff; border-radius: 15px; border: 1px solid #bce0fd; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,122,255,0.05); }
Â  Â  Â  Â  .summary-block { padding: 18px; background: #fff4e5; border-radius: 15px; border: 1px solid #ffe2b3; margin-bottom: 20px; }
Â  Â  Â  Â  .stat-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #d1e9ff; font-size: 14px; align-items: center; }
Â  Â  Â  Â  .stat-item:last-child { border-bottom: none; }
Â  Â  Â  Â  .stat-value { font-weight: bold; text-align: right; color: #333; }
Â  Â  Â  Â  .efi-val { color: #007AFF; font-size: 24px; font-weight: 900; }
Â  Â  Â  Â  .trend-up { color: #28a745; font-weight: bold; }
Â  Â  Â  Â  .trend-down { color: #dc3545; font-weight: bold; }
Â  Â  </style>
</head>
<body>
<div class="card">
Â  Â  <h2>ğŸ¯ EFI å°„ç®­é›™è»¸è¨ºæ–·ç³»çµ±</h2>

Â  Â  <label>ğŸ¯ é¶ç´™ä¿‚æ•¸è¨­å®š / è·é›¢æ¨ä¼°ä¿‚æ•¸Kå€¼è¨­å®š</label>
Â  Â  <div class="row">
Â  Â  Â  Â  <select id="faceSize">
Â  Â  Â  Â  Â  Â  <option value="122">122cm (70må¤§é¶)</option>
Â  Â  Â  Â  Â  Â  <option value="80" selected>80cm (30/50mä¸­é¶)</option>
Â  Â  Â  Â  </select>

Â  Â  Â  Â  <input type="number" id="kValue" value="1" step="0.1" placeholder="Kå€¼">
Â  Â  </div>

Â  Â  <div class="section-title">âš–ï¸ X è»¸æ°´å¹³åº§æ¨™cm </div>
Â  Â  <div class="row">
Â  Â  Â  Â  <input type="number" id="pxE" step="0.0001" placeholder="å‰æ¬¡ EFI">
Â  Â  Â  Â  <input type="number" id="pxM" step="0.01" placeholder="å‰æ¬¡é›¢å·®">
Â  Â  </div>
Â  Â  <input type="text" id="inX" placeholder="è¼¸å…¥ X åº§æ¨™ï¼Œç”¨é€—é»éš”é–‹">
Â  Â  <div class="note">å³å´ç‚ºæ­£ (+)ï¼Œå·¦å´ç‚ºè²  (-)</div>

Â  Â  <div class="section-title">â†•ï¸ Y è»¸å‚åº§æ¨™cm</div>
Â  Â  <div class="row">
Â  Â  Â  Â  <input type="number" id="pyE" step="0.0001" placeholder="å‰æ¬¡ EFI">
Â  Â  Â  Â  <input type="number" id="pyM" step="0.01" placeholder="å‰æ¬¡é›¢å·®">
Â  Â  </div>
Â  Â  <input type="text" id="inY" placeholder="è¼¸å…¥ Y åº§æ¨™ï¼Œç”¨é€—é»éš”é–‹">
Â  Â  <div class="note">ä¸Šæ–¹ç‚ºæ­£ (+)ï¼Œä¸‹æ–¹ç‚ºè²  (-)</div>

Â  Â  <button onclick="runDiag()">åŸ·è¡Œé›™è»¸æ•¸æ“šè¨ºæ–·</button>

Â  Â  <div id="out" class="res-container">
Â  Â  Â  Â  <div id="summary" class="summary-block">
Â  Â  Â  Â  Â  Â  <div style="font-weight:bold; color:#e67e22; margin-bottom:8px;">ğŸ’¡ ç¶œåˆåˆ†æå»ºè­°</div>
Â  Â  Â  Â  Â  Â  <div id="summaryText" style="font-size:15px; line-height:1.5; color:#5d4037;"></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="res-block">
Â  Â  Â  Â  Â  Â  <div style="font-weight:bold; color:#007AFF; margin-bottom:12px;">ğŸ“Š X è»¸æ°´å¹³åˆ†æå ±å‘Š</div>
Â  Â  Â  Â  Â  Â  <div class="stat-item"><span class="stat-label">æœ¬æ¬¡ EFI æŒ‡æ¨™</span><span id="rxE" class="efi-val"></span></div>
Â  Â  Â  Â  Â  Â  <div id="cxE" class="stat-item" style="display:none;"><span class="stat-label">EFI è¶¨å‹¢</span><span id="dxE" class="stat-value"></span></div>
Â  Â  Â  Â  Â  Â  <div class="stat-item"><span class="stat-label">ä¸­å¿ƒåç§»å¹³å‡</span><span id="offX" class="stat-value"></span></div>
Â  Â  Â  Â  Â  Â  <div class="stat-item"><span class="stat-label">å‹•ä½œä¸€è‡´æ€§ (é›¢å·®)</span><span id="madX" class="stat-value"></span></div>
Â  Â  Â  Â  Â  Â  <div id="cxM" class="stat-item" style="display:none;"><span class="stat-label">ä¸€è‡´æ€§è¶¨å‹¢</span><span id="dxM" class="stat-value"></span></div>
Â  Â  Â  Â  Â  Â  <div class="stat-item"><span class="stat-label">æ¨£æœ¬èª¤å·®æ©Ÿç‡</span><span id="prX" class="stat-value"></span></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="res-block">
Â  Â  Â  Â  Â  Â  <div style="font-weight:bold; color:#007AFF; margin-bottom:12px;">ğŸ“Š Y è»¸å‚ç›´åˆ†æå ±å‘Š</div>
Â  Â  Â  Â  Â  Â  <div class="stat-item"><span class="stat-label">æœ¬æ¬¡ EFI æŒ‡æ¨™</span><span id="ryE" class="efi-val"></span></div>
Â  Â  Â  Â  Â  Â  <div id="cyE" class="stat-item" style="display:none;"><span class="stat-label">EFI è¶¨å‹¢</span><span id="dyE" class="stat-value"></span></div>
Â  Â  Â  Â  Â  Â  <div class="stat-item"><span class="stat-label">ä¸­å¿ƒåç§»å¹³å‡</span><span id="offY" class="stat-value"></span></div>
Â  Â  Â  Â  Â  Â  <div class="stat-item"><span class="stat-label">å‹•ä½œä¸€è‡´æ€§ (é›¢å·®)</span><span id="madY" class="stat-value"></span></div>
Â  Â  Â  Â  Â  Â  <div id="cyM" class="stat-item" style="display:none;"><span class="stat-label">ä¸€è‡´æ€§è¶¨å‹¢</span><span id="dyM" class="stat-value"></span></div>
Â  Â  Â  Â  Â  Â  <div class="stat-item"><span class="stat-label">æ¨£æœ¬èª¤å·®æ©Ÿç‡</span><span id="prY" class="stat-value"></span></div>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<script>
function coreCalc(raw, d, k) {
Â  Â  const avg = raw.reduce((a, b) => a + b) / raw.length;
Â  Â  const R = raw.filter(v => v >= avg), L = raw.filter(v => v < avg);
Â  Â  const getM = (a) => {
Â  Â  Â  Â  if (!a.length) return 0;
Â  Â  Â  Â  const sA = a.reduce((p, c) => p + c) / a.length;
Â  Â  Â  Â  return a.reduce((p, c) => p + Math.abs(c - sA), 0) / a.length;
Â  Â  };
Â  Â  const mR = getM(R), mL = getM(L);
Â  Â  const dR = R.length ? Math.abs((R.reduce((a,b)=>a+b)/R.length)-avg) : 0;
Â  Â  const dL = L.length ? Math.abs((L.reduce((a,b)=>a+b)/L.length)-avg) : 0;
Â  Â  const pen = (k * dR) + (k * dL) + (k * (mR * R.length + mL * L.length) / raw.length);
Â  Â  const efi = parseFloat((10 * ((d - pen) / d) + 1).toFixed(4));
Â  Â  const mad = parseFloat(((R.length * mR) + (L.length * mL)) / raw.length);
Â  Â  return { efi, mad, avg, mR, mL, nR: R.length, nL: L.length };
}

function runDiag() {
Â  Â  const d = parseFloat(document.getElementById('faceSize').value);
Â  Â  const k = parseFloat(document.getElementById('kValue').value);
Â  Â  const xData = document.getElementById('inX').value.split(',').map(Number).filter(n => !isNaN(n));
Â  Â  const yData = document.getElementById('inY').value.split(',').map(Number).filter(n => !isNaN(n));

Â  Â  if (xData.length < 2 || yData.length < 2) return alert("è«‹è¼¸å…¥å®Œæ•´ XY æ•¸æ“š");
Â  Â  document.getElementById('out').style.display = 'block';

Â  Â  const resX = coreCalc(xData, d, k);
Â  Â  const resY = coreCalc(yData, d, k);

Â  Â  // X è»¸é¡¯ç¤º
Â  Â  document.getElementById('rxE').innerText = resX.efi;
Â  Â  document.getElementById('offX').innerText = `${resX.avg.toFixed(2)} cm ${resX.avg<0?"(åå·¦)":"(åå³)"}`;
Â  Â  document.getElementById('madX').innerText = resX.mad.toFixed(2);
Â  Â  const exX = resX.mR >= resX.mL ? {s:"å³å´", n:resX.nR} : {s:"å·¦å´", n:resX.nL};
Â  Â  document.getElementById('prX').innerText = `${((exX.n/12)*100).toFixed(0)}% (${exX.s})`;

Â  Â  // Y è»¸é¡¯ç¤º
Â  Â  document.getElementById('ryE').innerText = resY.efi;
Â  Â  document.getElementById('offY').innerText = `${resY.avg.toFixed(2)} cm ${resY.avg<0?"(åä¸Š)":"(åä¸‹)"}`;
Â  Â  document.getElementById('madY').innerText = resY.mad.toFixed(2);
Â  Â  const exY = resY.mR >= resY.mL ? {s:"ä¸Šå´", n:resY.nR} : {s:"ä¸‹å´", n:resY.nL};
Â  Â  document.getElementById('prY').innerText = `${((exY.n/12)*100).toFixed(0)}% (${exY.s})`;

Â  Â  // è¶¨å‹¢æ¯”å°é‚è¼¯ (X & Y)
Â  Â  const compare = (curE, prevE, idRow, idVal) => {
Â  Â  Â  Â  if(!isNaN(prevE)) {
Â  Â  Â  Â  Â  Â  document.getElementById(idRow).style.display = 'flex';
Â  Â  Â  Â  Â  Â  const df = curE - prevE;
Â  Â  Â  Â  Â  Â  document.getElementById(idVal).innerHTML = df>=0 ? `<span class="trend-up">â†‘ æå‡ ${df.toFixed(4)}</span>` : `<span class="trend-down">â†“ ä¸‹é™ ${Math.abs(df).toFixed(4)}</span>`;
Â  Â  Â  Â  }
Â  Â  };
Â  Â  const compareM = (curM, prevM, idRow, idVal) => {
Â  Â  Â  Â  if(!isNaN(prevM)) {
Â  Â  Â  Â  Â  Â  document.getElementById(idRow).style.display = 'flex';
Â  Â  Â  Â  Â  Â  const df = curM - prevM;
Â  Â  Â  Â  Â  Â  document.getElementById(idVal).innerHTML = df<0 ? `<span class="trend-up">é€²æ­¥ (ç¸®å° ${Math.abs(df).toFixed(2)})</span>` : `<span class="trend-down">åŠ æ²¹ (æ”¾å¤§ ${df.toFixed(2)})</span>`;
Â  Â  Â  Â  }
Â  Â  };
Â  Â  compare(resX.efi, parseFloat(document.getElementById('pxE').value), 'cxE', 'dxE');
Â  Â  compareM(resX.mad, parseFloat(document.getElementById('pxM').value), 'cxM', 'dxM');
Â  Â  compare(resY.efi, parseFloat(document.getElementById('pyE').value), 'cyE', 'dyE');
Â  Â  compareM(resY.mad, parseFloat(document.getElementById('pyM').value), 'cyM', 'dyM');

Â  Â  // ç¸½çµå ±å‘Š
Â  Â  let summary = "";
Â  Â  if (resX.efi < resY.efi) {
Â  Â  Â  Â  summary = "âš ï¸ **æ³¨æ„ X è»¸ (æ°´å¹³)**ï¼šæ°´å¹³ EFI è¼ƒä½ï¼Œè«‹å„ªå…ˆæª¢æŸ¥æ”¾å¼¦ å¾Œæ‰‹è§’åº¦ä¸€è‡´æ€§æˆ–Tå­—æˆ–å¼¦å½± æ¨é»ç¢ºèªã€‚";
Â  Â  } else if (resY.efi < resX.efi) {
Â  Â  Â  Â  summary = "âš ï¸ **æ³¨æ„ Y è»¸ (å‚ç›´)**ï¼šå‚ç›´ EFI è¼ƒä½ï¼Œè«‹æª¢æŸ¥æ¨å¼“æ‰‹å£“åŠ›é»æ˜¯å¦ç©©å®š æŒ‰å¡é å¼¦ä½ç½® å‰è‚©ç©©å®šã€‚";
Â  Â  } else {
Â  Â  Â  Â  summary = "âœ… **é›™è»¸å¹³è¡¡**ï¼šç›®å‰å™¨æè¨­å®šåœ¨å…©å€‹ç¶­åº¦è¡¨ç¾å‡ç­‰ã€‚";
Â  Â  }

    // å¤–æ›ä¿®æ­£éƒ¨åˆ†ï¼šåƒ…é¡¯ç¤ºæ–¹å‘å¾®èª¿å»ºè­°èˆ‡ç²¾æº–å´
    const adjX = resX.avg < 0 ? "å·¦" : "å³";
    const adjY = resY.avg > 0 ? "ä¸Š" : "ä¸‹";
    const bestX = resX.mR < resX.mL ? "å³å´" : "å·¦å´";
    const bestY = resY.mR < resY.mL ? "ä¸Šå´" : "ä¸‹å´";

    summary += `\n\nğŸ› ï¸ **ç„æº–å™¨æ–¹å‘å¾®èª¿å»ºè­°**ï¼š\nè«‹å°‡ç„æº–å™¨å‘ã€${adjX}ã€‘ä¸”å‘ã€${adjY}ã€‘æ’¥å‹•ã€‚`;
    summary += `\n\nâœ¨ **è¼ƒç²¾æº–çš„å‹•ä½œè¡¨ç¾å´**ï¼š\næ°´å¹³æ–¹å‘ä»¥ã€${bestX}ã€‘è¼ƒç©©ï¼Œå‚ç›´æ–¹å‘ä»¥ã€${bestY}ã€‘è¼ƒç©©ã€‚è«‹å›æƒ³ä¸¦ä¿æŒè©²å´ç™¼åŠ›æ„Ÿã€‚`;

Â  Â  document.getElementById('summaryText').innerText = summary;
}
</script>
</body>
</html>
